/**
*
*   Asynchronous.js
*   @version: 0.3
*
*   Simple JavaScript class to manage asynchronous, parallel, sequential and interleaved tasks
*   https://github.com/foo123/asynchronous.js
*
**/!function(e,n,t,r,o){"use strict";var s="undefined"!=typeof global&&"[object global]"==={}.toString.call(global),i=!s&&"undefined"!=typeof navigator,u="function"==typeof importScripts&&navigator instanceof WorkerNavigator,a=Array,l=a.prototype,c=function(){var e=null;if(s)return e=__filename,{path:__dirname,file:__filename};if(u)e=self.location.href;else if(i){var n;(n=document.getElementsByTagName("script"))&&n.length&&(e=n[n.length-1].src)}return e?{path:e.split("/").slice(0,-1).join("/"),file:e}:{path:null,file:null}},f=c(),p=function(e,n){if(s)return n;if("."==n.charAt(0)){e=e.split("/"),n=n.split("/");var t,r=0,o=0,i=n.length,u=e.length;for(t=0;i>t;t++)if(/^\.\./.test(n[t]))r++,o++;else{if(!/^\./.test(n[t]))break;o++}r=r>=u?0:u-r,n=e.slice(0,r).concat(n.slice(o)).join("/")}return n};t=t?[].concat(t):[];var h,d,m,v=t.length,g=new a(v),E=new a(v),N=new a(v),y=new a(v);for(h=0;v>h;h++)g[h]=t[h][0],E[h]=t[h][1],N[h]=/\.js$/i.test(E[h])?p(f.path,E[h]):p(f.path,E[h]+".js");if("object"==typeof module&&module.exports){if(o===module.exports[n]){for(h=0;v>h;h++)y[h]=module.exports[g[h]]||require(N[h])[g[h]];d=r.apply(e,y),module.exports[n]=d||1}}else if("function"==typeof define&&define.amd)define(["exports"].concat(E),function(t){if(o===t[n]){for(var s=l.slice.call(arguments,1),i=s.length,u=0;i>u;u++)y[u]=t[g[u]]||s[u];d=r.apply(e,y),t[n]=d||1}});else if(u){for(h=0;v>h;h++)self[g[h]]||importScripts(N[h]),y[h]=self[g[h]];d=r.apply(e,y),self[n]=d||1}else if(o===e[n]){var T=function(e,n){m=m||document.getElementsByTagName("head")[0];var t=0,r=document.createElement("script");r.type="text/javascript",r.language="javascript",r.onload=r.onreadystatechange=function(){t||r.readyState&&"loaded"!=r.readyState&&"complete"!=r.readyState||(t=1,r.onload=r.onreadystatechange=null,m.removeChild(r),r=null,n&&n())},r.src=e,m.appendChild(r)},$=function(n,t,r){e[n]?r():T(t,r)},A=function(t){return function(){v>t&&(y[t]=e[g[t]]),++t<v?$(g[t],N[t],A(t)):(d=r.apply(e,y),e[n]=d||1)}};v?$(g[0],N[0],A(0)):(d=r.apply(e,y),e[n]=d||1)}}(this,"Asynchronous",null,function(){var EXPORTS={};return!function(root,exports,undef){"use strict";function runParallelised(e){return e.$run_mode=PARALLELISED,e}function runLinearised(e){var n,t=e,r=t.$queue;if(t.$run_mode=LINEARISED,r){for(;r.length&&(!r[0]||!r[0].canRun());)r.shift();r.length&&(n=r.shift(),n.run(),n.complete())}return t}function runInterleaved(e){var n,t=e,r=t.$queue,o=0;if(t.$run_mode=INTERLEAVED,r&&r.length){for(;o<r.length;)n=r[o],n&&n.canRun()?(n.run(),n.isFinished()?(r.shift(),n.complete()):o++):r.shift();t.$timer=setTimeout(curry(runInterleaved,t),t.$interval)}return t}function runSequenced(e){var n,t=e,r=t.$queue;return t.$run_mode=SEQUENCED,r&&r.length&&(n=r[0],n&&n.canRun()?(n.run(),n.isFinished()&&(r.shift(),n.complete())):r.shift(),t.$timer=setTimeout(curry(runSequenced,t),t.$interval)),t}var FP=Function.prototype,OP=Object.prototype,AP=Array.prototype,slice=FP.call.bind(AP.slice),toString=FP.call.bind(OP.toString),UNDEFINED=undef,UNKNOWN=0,NODE=1,BROWSER=2,DEFAULT_INTERVAL=60,NONE=0,INTERLEAVED=1,LINEARISED=2,PARALLELISED=3,SEQUENCED=4,isNode="undefined"!=typeof global&&"[object global]"===toString(global),isNodeProcess=!(!isNode||!process.env.NODE_UNIQUE_ID),isBrowser=!isNode&&"undefined"!=typeof navigator,isWebWorker=!isNode&&"function"==typeof importScripts&&navigator instanceof WorkerNavigator,supportsMultiThread=isNode||"function"==typeof Worker,isThread=isNodeProcess||isWebWorker,Thread,numProcessors=isNode?require("os").cpus().length:4,fromJSON=JSON.parse,toJSON=JSON.stringify,onMessage,curry=function(e,n){return function(){return e(n)}},URL=root.webkitURL||root.URL||null,blobURL=function(e){return URL?URL.createObjectURL(new Blob([e||""],{type:"text/javascript"})):e},path=function(){var e,n=null;return isNode?{path:__dirname,file:__filename}:(isWebWorker?n=self.location.href:isBrowser&&(e=document.getElementsByTagName("script"))&&e.length&&(n=e[e.length-1].src),n?{path:n.split("/").slice(0,-1).join("/"),file:""+n}:{path:null,file:null})},thisPath=path(),notThisPath=function(e){return e&&e.length&&e!==thisPath.file};if(onMessage=isWebWorker?function(e){e&&(onmessage=e)}:isNodeProcess?function(e){e&&process.on("message",function(n){e(fromJSON(n))})}:function(){},isNode){var fs=require("fs"),ps=require("child_process");root.close=function(){process.exit()},root.postMessage=function(e){process.send(toJSON({data:e}))},root.importScripts=function(scripts){if(scripts){scripts=scripts.split(",");for(var i=0,src,ok;i<scripts.length;){ok=!0;try{src=fs.readFileSync(scripts[i++]),eval(src)}catch(e){ok=e}if(!0!==ok)throw ok}}},Thread=function(e){var n=this;n.process=ps.fork(e),n.process.on("message",function(e){n.onmessage&&n.onmessage(fromJSON(e))}),n.process.on("error",function(e){n.onerror&&n.onerror(e)})},Thread.prototype={constructor:Thread,process:null,onmessage:null,onerror:null,postMessage:function(e){return this.process&&this.process.send(toJSON({data:e})),this},terminate:function(){return this.process&&(this.process.kill(),this.process=null),this}}}else Thread=Worker;var Task=function(e){if(e instanceof Task)return e;if(!(this instanceof Task))return new Task(e);1>arguments.length&&(e=null);var n=this,t=null,r=null,o=!1,s=!1,i=!1,u=!1,a=!1,l=!1,c=null,f=0,p=1,h=null,d=null,m=null,v=undef,g=function(){return v=e(),o=!0,v};n.task=function(t){return e=t,n},n.queue=function(e){return arguments.length?(t=e,n):t},n.canRun=function(){return e&&(!o||s||i||u||a||l)?(s||i)&&f>=h?!1:i&&!c?!1:(u||a)&&v===d?!1:!0:!1},n.run=g,n.iif=function(t,r,o){return t?e=r:arguments.length>2&&(e=o),n},n.until=function(e){return v=undef,c=null,d=e,a=!0,l=!1,s=!1,i=!1,u=!1,n.run=g,n},n.untilNot=function(e){return v=undef,c=null,m=e,l=!0,a=!1,s=!1,i=!1,u=!1,n.run=g,n},n.times=function(t,r,d){return v=undef,c=null,f=r||0,p=d||1,h=t,s=!0,a=!1,l=!1,i=!1,u=!1,n.run=function(){var n;return n=e(f),f+=p,v=n,o=!0,n},n},n.loopOver=function(t){return v=undef,c=t,f=0,p=1,h=t?t.length||0:0,i=!0,a=!1,l=!1,s=!1,u=!1,n.run=function(){var n;return n=e(c[f],f),f++,v=n,o=!0,n},n},n.recurse=function(t,r){return c=null,v=t,d=r,u=!0,a=!1,l=!1,s=!1,i=!1,n.run=function(){var n;return n=e(v),v=n,o=!0,n},n},n.isFinished=function(){var e=!o||l||a||s||i||u;return e&&(a||u)&&v===d&&(e=!1),e&&l&&v!==m&&(e=!1),e&&(s||i)&&f>=h&&(e=!1),!e},n.onComplete=function(e){return r=e||null,n},n.complete=function(){return r&&"function"==typeof r&&r(),n}};Task.iif=function(){var e=slice(arguments),n=new Task;return n.iif.apply(n,e)},Task.until=function(){var e=slice(arguments),n=new Task(e.pop());return n.until.apply(n,e)},Task.untilNot=function(){var e=slice(arguments),n=new Task(e.pop());return n.untilNot.apply(n,e)},Task.times=function(){var e=slice(arguments),n=new Task(e.pop());return n.times.apply(n,e)},Task.loopOver=function(){var e=slice(arguments),n=new Task(e.pop());return n.loopOver.apply(n,e)},Task.recurse=function(){var e=slice(arguments),n=new Task(e.pop());return n.recurse.apply(n,e)};var Field=function(e){return new Function("o","return o"+(e||"")+";")},Asynchronous=exports.Asynchronous=function(e){if(!(this instanceof Asynchronous))return new Asynchronous(e);var n=this;n.$interval=arguments.length?parseInt(e,10):DEFAULT_INTERVAL,n.$timer=null,n.$run_mode=NONE,n.$queue=[],isThread&&(n.$events={},onMessage(function(e){var t=e.data.event,r=e.data.data||null;t&&n.$events[t]?n.$events[t](r):"dispose"===t&&(n.dispose(),close())}))};if(Asynchronous.VERSION="0.3",Asynchronous.Task=Task,Asynchronous.Field=Field,Asynchronous.MODE={NONE:NONE,INTERLEAVE:INTERLEAVED,LINEAR:LINEARISED,PARALLEL:PARALLELISED,SEQUENCE:SEQUENCED},Asynchronous.Platform={UNDEFINED:UNDEFINED,UNKNOWN:UNKNOWN,NODE:NODE,BROWSER:BROWSER},Asynchronous.supportsMultiThreading=function(){return supportsMultiThread},Asynchronous.isPlatform=function(e){return NODE===e?isNode:BROWSER===e?isBrowser:undef},Asynchronous.isThread=function(e){return NODE===e?isNodeProcess:BROWSER===e?isWebWorker:isThread},Asynchronous.currentPath=path,Asynchronous.requestAnimationFrame=function(e){return e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||function(e){setTimeout(e,1e3/60)}}(root),Asynchronous.prototype={constructor:Asynchronous,VERSION:Asynchronous.VERSION,$interval:DEFAULT_INTERVAL,$timer:null,$queue:null,$thread:null,$events:null,$run_mode:NONE,dispose:function(){var e=this;return e.unfork(),e.$timer&&clearTimeout(e.$timer),e.$thread=null,e.$timer=null,e.$interval=null,e.$queue=null,e.$run_mode=NONE,e},empty:function(){var e=this;return e.$timer&&clearTimeout(e.$timer),e.$timer=null,e.$queue=[],e.$run_mode=NONE,e},interval:function(e){return arguments.length?(this.$interval=parseInt(e,10),this):this.$interval},fork:function(e,n){var t,r,o,s=this;if(!s.$thread){if(!supportsMultiThread)throw s.$thread=null,new Error("Asynchronous: Multi-Threading is NOT supported!");isNode?(r="Asynchronous: Thread (Process): ",o="Asynchronous: Thread (Process) Error: "):(r="Asynchronous: Thread (Worker): ",o="Asynchronous: Thread (Worker) Error: "),s.$events=s.$events||{},t=s.$thread=new Thread(thisPath.file),t.onmessage=function(e){if(e.data.event){var n=e.data.event,t=e.data.data||null;s.$events&&s.$events[n]?s.$events[n](t):("console.log"===n||"console.error"===n)&&console.log(r+(t.output||""))}},t.onerror=function(e){if(!s.$events||!s.$events.error)throw new Error(o+e.message+" file: "+e.filename+" line: "+e.lineno);s.$events.error(e)},s.send("initThread",{component:e||null,imports:n?[].concat(n):null})}return s},unfork:function(){var e=this;return e.$thread&&e.send("dispose"),e.$thread=null,e.$events=null,e},listen:function(e,n){return e&&"function"==typeof n&&this.$events&&(this.$events[e]=n),this},unlisten:function(e,n){return e&&this.$events&&this.$events[e]&&(2>arguments.length||n===this.$events[e])&&delete this.$events[e],this},send:function(e,n){return e&&(isThread?postMessage({event:e,data:n||null}):this.$thread&&this.$thread.postMessage({event:e,data:n||null})),this},task:function(e){return e instanceof Task?e:"function"==typeof e?Task(e):void 0},step:function(e){var n=this;return e&&n.$queue.push(n.task(e).queue(n)),n},steps:function(){var e,n,t=this,r=slice(arguments);for(n=r.length,e=0;n>e;e++)t.step(r[e]);return t},jumpNext:function(e,n){var t=this,r=t.$queue;return e=e||0,!0===n?function(){return e<r.length&&(e>0&&r.splice(0,e),t.run(t.$run_mode)),t}:(e<r.length&&(e>0&&r.splice(0,e),t.run(t.$run_mode)),t)},abort:function(e,n){var t=this;return!0===e?function(){return n&&n>0?setTimeout(function(){t.empty()},n):t.empty(),t}:(n&&n>0?setTimeout(function(){t.empty()},n):t.empty(),t)},run:function(e){var n=this;return arguments.length?n.$run_mode=e:e=n.$run_mode,SEQUENCED===e?runSequenced(n):INTERLEAVED===e?runInterleaved(n):LINEARISED===e?runLinearised(n):PARALLELISED===e&&runParallelised(n),n}},isThread){var Component=null;root.console={log:function(e){postMessage({event:"console.log",data:{output:e||""}})},error:function(e){postMessage({event:"console.error",data:{output:e||""}})}},onMessage(function(e){var n=e.data.event,t=e.data.data||null;switch(n){case"initThread":if(t){if(t.imports&&t.imports.length){var r=t.imports.filter(notThisPath);r.length&&importScripts(r.join(","))}if(t.component){Component&&("function"==typeof Component.dispose&&Component.dispose(),Component=null);for(var o=t.component.split("."),s=root;o.length;)o[0]&&o[0].length&&s[o[0]]&&(s=s[o[0]]),o.shift();s&&root!==s&&(Component=new s)}}break;case"dispose":default:Component&&("function"==typeof Component.dispose&&Component.dispose(),Component=null),close()}})}}(this,EXPORTS),EXPORTS.Asynchronous});